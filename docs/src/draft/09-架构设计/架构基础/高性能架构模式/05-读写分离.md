> <<从0开始学架构>> 学习笔记Day05：高性能架构模式-读写分离

# 读写分离原理

读写分离的基本原理是将数据库读写操作分散到不同的节点上，分散访问压力

![](https://static001.geekbang.org/resource/image/36/07/362d22168bf344687ec0c206aa115807.jpg?wh=2744*1943)

读写分离的基本实现是：数据库服务器搭建主从集群，一主一从、一主多从都可以。数据库主机负责读写操作，从机只负责读操作。数据库主机通过复制将数据同步到从机，每台数据库服务器都存储了所有的业务数据。业务服务器将写操作发给数据库主机，将读操作发给数据库从机。

读写分离的实现逻辑并不复杂，但有两个细节点将引入设计复杂度：主从复制延迟和分配机制。


# 复制延迟

解决主从复制延迟有几种常见的方法：

1. 写操作后的读操作指定发给数据库主服务器
2. 读从机失败后再读一次主机
3. 关键业务读写操作全部指向主机，非关键业务采用读写分离

# 分配机制

将读写操作区分开来，然后访问不同的数据库服务器，一般有两种方式：程序代码封装和中间件封装。

1. 程序代码封装

优点：实现简单，而且可以根据业务做较多定制化的功能

缺点：故障情况下，如果主从发生切换，则可能需要所有系统都修改配置并重启

![](https://static001.geekbang.org/resource/image/f8/df/f8d538f9201e3ebee37dfdcd1922e9df.jpg?wh=2661*2178)

2. 中间件封装

优点：数据库主从切换对业务服务器无感知，数据库中间件可以探测数据库服务器的主从状态

缺点：数据库中间件要支持完整的 SQL 语法和数据库服务器的协议（例如，MySQL 客户端和服务器的连接协议），实现比较复

![](https://static001.geekbang.org/resource/image/2a/8e/2a2dba7f07581fd055d9cd5a3aa8388e.jpg?wh=2918*1905)